"undefined"==typeof window?this.d3Chart=this.d3Chart||{}:window.d3Chart=window.d3Chart||{},function(){var a=function(a,b,c){var c=c||window,d=!1,e=function(){d||(d=!0,requestAnimationFrame(function(){c.dispatchEvent(new CustomEvent(b)),d=!1}))};c.addEventListener(a,e)};a("resize","optimizedResize")}(),function(){function a(a){this.internal={},this.internal.xScale,this.internal.yScale,this.internal.xAxis,this.internal.yAxis,this.internal.xAxisLabel,this.internal.yAxisLabel,this.internal.xColumnType,this.internal.yColumnType,this.internal.container,this.internal.svg,this.internal.chartGroup,this.internal.point,this.internal.brush,this.internal.kdRect,this.internal.quadTreeFactory,this.internal.quadTree,a&&(this.create(a),this.config.data.length>0&&this.renderChart(this.config.data))}function b(a,b){var c=this.config.columns.x;if("string"==typeof a[c]){if(isNaN(Number(a[c])))return this.internal.xColumnType="string",void 0===a.index?(a.index=b,b):("string"==typeof a.index&&(a.index=Number(a.index)),a.index);this.internal.xColumnType="number",a[c]=Number(a[c])}return a[c]}function c(a,c){return this.internal.xScale(b.call(this,a,c))}function d(a){var b=this.config.columns.y;if("string"==typeof a[b]){if(isNaN(Number(a[b])))return this.internal.yColumnType="string",void 0===a.index?(a.index=i,i):("string"==typeof a.index&&(a.index=Number(a.index)),a.index);this.internal.yColumnType="number",a[b]=Number(a[b])}return a[b]}function e(a,b){return this.internal.yScale(d.call(this,a,b))}function f(a,c,e,f,g){var h=[],i=this.config.columns.key;return a.visit(function(a,j,k,l,m){var n=a.point;if(n){n.scanned=!0;var o=this.internal.xScale(b.call(this,n),n.index),p=this.internal.yScale(d.call(this,n),n.index);n.selected=o>=c&&f>o&&p>=e&&g>p,n.selected&&h.push(n[i])}return j>=f||k>=g||c>l||e>m}.bind(this)),h}function g(){var a=this.config.interactions.onSelect,b=this.internal.brush.extent();this.internal.point.each(function(a){a.scanned=a.selected=!1});var c=f.call(this,this.internal.quadTree,b[0][0],b[0][1],b[1][0],b[1][1]);this.select(),c&&a&&a.callback&&a.callback.call(this,c)}function h(a,c,e,f){var g=f.x1,i=f.y1,j=f.x2,k=f.y2;if(f.visited=!0,a<g-e.d||a>j+e.d||c<i-e.d||c>k+e.d)return e;var l=f.point;if(l){l.scanned=!0;var m=this.internal.xScale(b.call(this,l),l.index)-a,n=this.internal.yScale(d.call(this,l),l.index)-c,o=Math.sqrt(m*m+n*n);o<e.d&&(e.d=o,e.p=l)}var p=f.nodes,q=2*a>g+j,r=2*c>i+k;return p[2*r+q]&&(e=h.call(this,a,c,e,p[2*r+q])),p[2*r+(1-q)]&&(e=h.call(this,a,c,e,p[2*r+(1-q)])),p[2*(1-r)+q]&&(e=h.call(this,a,c,e,p[2*(1-r)+q])),p[2*(1-r)+(1-q)]&&(e=h.call(this,a,c,e,p[2*(1-r)+(1-q)])),e}function j(){var a=this.config.interactions.onProbe,b=this.config.columns.key,c=+this.internal.probeCircle.attr("cx"),d=+this.internal.probeCircle.attr("cy");this.internal.point.each(function(a){a.scanned=a.selected=!1}),this.internal.kdRect.each(function(a){a.visited=!1});var e=h.call(this,c,d,{d:8,p:null},this.internal.quadTree);e.p&&(e.p.selected=!0),this.probe(),a&&a.callback&&(e.p?a.callback.call(this,e.p[b]):a.callback.call(this,null))}function k(a){var b=[];return a.depth=0,a.visit(function(a,c,d,e,f){a.x1=c,a.y1=d,a.x2=e,a.y2=f,b.push(a);for(var g=0;4>g;g++)a.nodes[g]&&(a.nodes[g].depth=a.depth+1)}),b}function l(a){function b(){{var b=parseInt(c.style("width"));parseInt(c.style("height"))}a.attr("width",b)}var c=d3.select(a.node().parentNode),d=parseInt(a.style("width")),e=parseInt(a.style("height"));a.attr("viewBox","0 0 "+d+" "+e).attr("perserveAspectRatio","none").call(b),d3.select(window).on("resize."+c.attr("id"),b)}function m(){var a=this;this.internal.xScale=d3.scale.linear().range([0,this.config.size.width]),this.internal.xAxis=d3.svg.axis().scale(this.internal.xScale).orient("bottom").tickFormat(function(b){var c=b;if("string"===a.internal.xColumnType){var d=a.config.data[b];c=d?d[a.config.columns.x]:""}return c}),this.internal.yScale=d3.scale.linear().range([this.config.size.height,0]),this.internal.yAxis=d3.svg.axis().scale(this.internal.yScale).orient("left").tickFormat(function(b){var c=b;if("string"===a.internal.yColumnType){var d=a.config.data[b];c=d?d[a.config.columns.y]:""}return c}),this.internal.svg=this.internal.container.append("svg").attr("width",this.config.size.width+this.config.margin.left+this.config.margin.right).attr("height",this.config.size.height+this.config.margin.top+this.config.margin.bottom).call(l),this.internal.chartGroup=this.internal.svg.append("g").attr("transform","translate("+this.config.margin.left+","+this.config.margin.top+")").on("mousemove",function(){var b=d3.mouse(d3.select(this)[0][0]);a.internal.probeCircle.attr("cx",b[0]),a.internal.probeCircle.attr("cy",b[1]),j.call(a)}),this.internal.brush=d3.svg.brush().x(d3.scale.identity().domain([-5,this.config.size.width+5])).y(d3.scale.identity().domain([-5,this.config.size.height+5])).on("brush",g.bind(a)),this.internal.chartGroup.append("g").attr("class","brush").call(this.internal.brush),this.internal.probeCircle=this.internal.chartGroup.append("circle").attr("id",this.config.container.id+"pt").attr("r",6).style("fill","none"),this.internal.quadTreeFactory=d3.geom.quadtree().extent([[0,0],[this.config.size.width,this.config.size.height]]).x(c.bind(this)).y(e.bind(this))}function n(){var a=this.config.data,d=this.config.columns.x;this.internal.xScale.domain([d3.min(a,b.bind(this)),d3.max(a,b.bind(this))]),this.internal.quadTreeFactory.x(c.bind(this)),this.internal.quadTree=this.internal.quadTreeFactory(a),this.internal.kdRect.data(k(this.internal.quadTree));var e=d3.select(this.config.container.element).transition();e.selectAll(".point").duration(750).attr("cx",c.bind(this)),e.selectAll(".node").duration(750).attr("x",function(a){return a.x1}).attr("y",function(a){return a.y1}).attr("width",function(a){return a.x2-a.x1}).attr("height",function(a){return a.y2-a.y1}),e.select(".x.axis").duration(750).call(this.internal.xAxis).selectAll("text").style("text-anchor","end").attr("dx","-.8em").attr("dy",".15em").attr("transform",function(){return"rotate(-45)"}),this.internal.xAxisLabel.text(d)}function o(){var a=this.config.data,b=this.config.columns.y;this.internal.yScale.domain([d3.min(a,d.bind(this)),d3.max(a,d.bind(this))]),this.internal.quadTreeFactory.y(e.bind(this)),this.internal.quadTree=this.internal.quadTreeFactory(a),this.internal.kdRect.data(k(this.internal.quadTree));var c=d3.select(this.config.container.element).transition();c.selectAll(".point").duration(750).attr("cy",e.bind(this)),c.selectAll(".node").duration(750).attr("x",function(a){return a.x1}).attr("y",function(a){return a.y1}).attr("width",function(a){return a.x2-a.x1}).attr("height",function(a){return a.y2-a.y1}),c.select(".y.axis").duration(750).call(this.internal.yAxis).selectAll("text").style("text-anchor","end").attr("dx","-.8em").attr("transform",function(){return"rotate(-45)"}),this.internal.yAxisLabel.text(b)}var p=a.prototype;p.create=function(a){this.config={},a.container?"String"===a.container.constructor.name?this.config.container={element:document.getElementById(a.container),id:a.container}:"HTMLDivElement"===a.container.constructor.name?this.config.container={element:a.container,id:a.container.id}:console.log("Error: "+a.container+" - Not a HTMLDivElement element "):"String"===this.config.container.constructor.name&&(this.config.container={element:document.getElementById(a.container),id:"body"}),this.internal.container=d3.select(this.config.container.element),a.size?(this.config.size=a.size,a.size.width||(this.config.size.width=parseInt(this.internal.container.style("width"),10)),a.size.height||(this.config.size.height=parseInt(this.internal.container.style("height"),10),0==this.config.size.height&&(this.config.size.height=400))):(this.config.size={},this.config.size.width=parseInt(this.internal.container.style("width"),10),this.config.size.height=parseInt(this.internal.container.style("height"),10),0==this.config.size.height&&(this.config.size.height=400)),a.margin?(this.config.margin=a.margin,a.margin.left||(this.config.margin.left=20),a.margin.right||(this.config.margin.right=20),a.margin.top||(this.config.margin.top=20),a.margin.bottom||(this.config.margin.bottom=20)):(this.config.margin={},this.config.margin.left=this.config.margin.right=this.config.margin.top=this.config.margin.bottom=20),this.config.columns=a.columns?a.columns:{x:"",y:"",key:""},this.config.data=a.data?a.data:[],this.config.interactions=a.interactions?a.interactions:{},m.call(this)},p.setXAttribute=function(a){this.config.columns.x!==a&&(this.config.columns.x=a,n.call(this))},p.setYAttribute=function(a){this.config.columns.y!==a&&(this.config.columns.y=a,o.call(this))},p.renderChart=function(a){if(a&&(this.config.data=a),!this.config.data)return void console.log("Data not found");var f=this.config.columns;if(!f.x)return void console.log("x column not set yet");if(!f.y)return void console.log("y column not set yet");if(!f.key)return void console.log("key column not set yet: Key column is must for interaction between charts");var g=this.config.data;this.internal.xScale.domain([d3.min(g,b.bind(this)),d3.max(g,b.bind(this))]),this.internal.yScale.domain([d3.min(g,d.bind(this)),d3.max(g,d.bind(this))]),this.internal.quadTree=this.internal.quadTreeFactory(g),this.internal.chartGroup.append("g").attr("class","x axis").attr("transform","translate(0,"+this.config.size.height+")").call(this.internal.xAxis).selectAll("text").style("text-anchor","end").attr("dx","-.8em").attr("dy",".15em").attr("transform",function(){return"rotate(-45)"}),this.internal.xAxisLabel=this.internal.chartGroup.append("text").attr("y",this.config.size.height+this.config.margin.top+this.config.margin.bottom/2).attr("x",this.config.size.width/2).attr("dy","1em").style("text-anchor","middle").text(f.x),this.internal.chartGroup.append("g").attr("class","y axis").call(this.internal.yAxis).selectAll("text").style("text-anchor","end").attr("dx","-.8em").attr("transform",function(){return"rotate(-45)"}),this.internal.yAxisLabel=this.internal.chartGroup.append("text").attr("transform","rotate(-90)").attr("y",0-this.config.margin.left).attr("x",0-this.config.size.height/2).attr("dy","1em").style("text-anchor","middle").text(f.y),this.internal.kdRect=this.internal.chartGroup.selectAll(".node").data(k(this.internal.quadTree)).enter().append("rect").attr("class","node").attr("x",function(a){return a.x1}).attr("y",function(a){return a.y1}).attr("width",function(a){return a.x2-a.x1}).attr("height",function(a){return a.y2-a.y1}),this.internal.point=this.internal.chartGroup.selectAll(".point").data(g).enter().append("circle").attr("class","point").attr("r",6).attr("cx",c.bind(this)).attr("cy",e.bind(this))},p.probe=function(a){var b=this.config.data,c=this.config.columns.key;a?(this.internal.point.each(function(a){a.scanned=a.selected=!1}),b.map(function(b){b[c]==a&&(b.selected=!0)})):null===a&&this.internal.point.each(function(a){a.scanned=a.selected=!1}),this.internal.point.classed("scanned",function(a){return a.scanned}),this.internal.point.classed("selected",function(a){return a.selected})},p.select=function(a){var b=this.config.data;a&&(this.internal.point.each(function(a){a.scanned=a.selected=!1}),b.filter(function(b){for(var c=0;c<a.length;c++)b[this.config.columns.key]===a[c]&&(b.selected=!0)}.bind(this))),a&&0===a.length&&this.internal.point.each(function(a){a.scanned=a.selected=!1}),this.internal.point.classed("scanned",function(a){return a.scanned}),this.internal.point.classed("selected",function(a){return a.selected})},d3Chart.Scatterplot=a}();
