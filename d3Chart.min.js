"undefined"==typeof window?this.d3Chart=this.d3Chart||{}:window.d3Chart=window.d3Chart||{},function(){var a=function(a,b,c){var c=c||window,d=!1,e=function(){d||(d=!0,requestAnimationFrame(function(){c.dispatchEvent(new CustomEvent(b)),d=!1}))};c.addEventListener(a,e)};a("resize","optimizedResize")}(),function(){function a(a){this.internal={},this.internal.xScale,this.internal.yScale,this.internal.xAxis,this.internal.yAxis,this.internal.xAxisLabel,this.internal.yAxisLabel,this.internal.xColumnType,this.internal.yColumnType,this.internal.svg,this.internal.chartGroup,this.internal.point,this.internal.brush,this.internal.kdRect,this.internal.quadTreeFactory,this.internal.quadTree,a&&(this.create(a),this.internal.config.data&&this.renderChart(this.internal.config.data))}function b(a,b){var c=this.internal.config.columns.x;if("string"==typeof a[c]){if(isNaN(Number(a[c])))return this.internal.xColumnType="string",void 0===a.index?(a.index=b,b):("string"==typeof a.index&&(a.index=Number(a.index)),a.index);this.internal.xColumnType="number",a[c]=Number(a[c])}return a[c]}function c(a,c){return this.internal.xScale(b.call(this,a,c))}function d(a){var b=this.internal.config.columns.y;if("string"==typeof a[b]){if(isNaN(Number(a[b])))return this.internal.yColumnType="string",void 0===a.index?(a.index=i,i):("string"==typeof a.index&&(a.index=Number(a.index)),a.index);this.internal.yColumnType="number",a[b]=Number(a[b])}return a[b]}function e(a,b){return this.internal.yScale(d.call(this,a,b))}function f(a,c,e,f,g){var h=[],i=this.internal.config.columns.key;return a.visit(function(a,j,k,l,m){var n=a.point;if(n){n.scanned=!0;var o=this.internal.xScale(b.call(this,n),n.index),p=this.internal.yScale(d.call(this,n),n.index);n.selected=o>=c&&f>o&&p>=e&&g>p,n.selected&&h.push(n[i])}return j>=f||k>=g||c>l||e>m}.bind(this)),h}function g(){var a=this.internal.config.interactions.onSelect,b=this.internal.brush.extent();this.internal.point.each(function(a){a.scanned=a.selected=!1});var c=f.call(this,this.internal.quadTree,b[0][0],b[0][1],b[1][0],b[1][1]);this.select(),c&&a&&a.callback&&a.callback.call(this,c)}function h(a,c,e,f){var g=f.x1,i=f.y1,j=f.x2,k=f.y2;if(f.visited=!0,a<g-e.d||a>j+e.d||c<i-e.d||c>k+e.d)return e;var l=f.point;if(l){l.scanned=!0;var m=this.internal.xScale(b.call(this,l),l.index)-a,n=this.internal.yScale(d.call(this,l),l.index)-c,o=Math.sqrt(m*m+n*n);o<e.d&&(e.d=o,e.p=l)}var p=f.nodes,q=2*a>g+j,r=2*c>i+k;return p[2*r+q]&&(e=h.call(this,a,c,e,p[2*r+q])),p[2*r+(1-q)]&&(e=h.call(this,a,c,e,p[2*r+(1-q)])),p[2*(1-r)+q]&&(e=h.call(this,a,c,e,p[2*(1-r)+q])),p[2*(1-r)+(1-q)]&&(e=h.call(this,a,c,e,p[2*(1-r)+(1-q)])),e}function j(){var a=this.internal.config.interactions.onProbe,b=this.internal.config.columns.key;pt=d3.selectAll(this.internal.container+"pt");var c=+pt.attr("cx"),d=+pt.attr("cy");this.internal.point.each(function(a){a.scanned=a.selected=!1}),this.internal.kdRect.each(function(a){a.visited=!1});var e=h.call(this,c,d,{d:8,p:null},this.internal.quadTree);e.p&&(e.p.selected=!0),this.probe(),a&&a.callback&&(e.p?a.callback.call(this,e.p[b]):a.callback.call(this,null))}function k(){var a=this.internal.config.data,d=this.internal.config.columns.x;this.internal.xScale.domain([d3.min(a,b.bind(this)),d3.max(a,b.bind(this))]),this.internal.quadTreeFactory.x(c.bind(this)),this.internal.quadTree=this.internal.quadTreeFactory(a),this.internal.kdRect.data(m(this.internal.quadTree));var e=d3.select(this.internal.container).transition();e.selectAll(".point").duration(750).attr("cx",c.bind(this)),e.selectAll(".node").duration(750).attr("x",function(a){return a.x1}).attr("y",function(a){return a.y1}).attr("width",function(a){return a.x2-a.x1}).attr("height",function(a){return a.y2-a.y1}),e.select(".x.axis").duration(750).call(this.internal.xAxis),this.internal.xAxisLabel.text(d)}function l(){var a=this.internal.config.data,b=this.internal.config.columns.y;this.internal.yScale.domain([d3.min(a,d.bind(this)),d3.max(a,d.bind(this))]),this.internal.quadTreeFactory.y(e.bind(this)),this.internal.quadTree=this.internal.quadTreeFactory(a),this.internal.kdRect.data(m(this.internal.quadTree));var c=d3.select(this.internal.container).transition();c.selectAll(".point").duration(750).attr("cy",e.bind(this)),c.selectAll(".node").duration(750).attr("x",function(a){return a.x1}).attr("y",function(a){return a.y1}).attr("width",function(a){return a.x2-a.x1}).attr("height",function(a){return a.y2-a.y1}),c.select(".y.axis").duration(750).call(this.internal.yAxis),this.internal.yAxisLabel.text(b)}function m(a){var b=[];return a.depth=0,a.visit(function(a,c,d,e,f){a.x1=c,a.y1=d,a.x2=e,a.y2=f,b.push(a);for(var g=0;4>g;g++)a.nodes[g]&&(a.nodes[g].depth=a.depth+1)}),b}function n(a){function b(){{var b=parseInt(c.style("width"));parseInt(c.style("height"))}a.attr("width",b)}var c=d3.select(a.node().parentNode),d=parseInt(a.style("width")),e=parseInt(a.style("height"));a.attr("viewBox","0 0 "+d+" "+e).attr("perserveAspectRatio","none").call(b),d3.select(window).on("resize."+c.attr("id"),b)}function o(){var a=this;this.internal.xScale=d3.scale.linear().range([0,this.internal.size.width]),this.internal.xAxis=d3.svg.axis().scale(this.internal.xScale).orient("bottom"),this.internal.yScale=d3.scale.linear().range([this.internal.size.height,0]),this.internal.yAxis=d3.svg.axis().scale(this.internal.yScale).orient("left"),this.internal.svg=d3.select(this.internal.container).append("svg").attr("width",this.internal.size.width+this.internal.margin.left+this.internal.margin.right).attr("height",this.internal.size.height+this.internal.margin.top+this.internal.margin.bottom).call(n),this.internal.chartGroup=this.internal.svg.append("g").attr("transform","translate("+this.internal.margin.left+","+this.internal.margin.top+")").on("mousemove",function(){var b=d3.mouse(d3.select(this)[0][0]);a.internal.svg.selectAll(a.internal.container+"pt").attr("cx",b[0]).attr("cy",b[1]),j.call(a)}),this.internal.brush=d3.svg.brush().x(d3.scale.identity().domain([-5,this.internal.size.width+5])).y(d3.scale.identity().domain([-5,this.internal.size.height+5])).on("brush",g.bind(a));{var b=this.internal.svg;b[0][0].parentElement}}var p=a.prototype;p.create=function(a){this.internal.config=a,this.internal.container=a.container?a.container:"body",a.size?(this.internal.size=this.internal.config.size,a.size.width||(this.internal.size.width=parseInt(d3.select(this.internal.container).style("width"),10)),a.size.height||(this.internal.size.height=parseInt(d3.select(this.internal.container).style("height"),10),0==this.internal.size.height&&(this.internal.size.height=400))):(this.internal.size={},this.internal.size.width=parseInt(d3.select(this.internal.container).style("width"),10),this.internal.size.height=parseInt(d3.select(this.internal.container).style("height"),10),0==this.internal.size.height&&(this.internal.size.height=400)),a.margin?(this.internal.margin=this.internal.config.margin,a.margin.left||(this.internal.margin.left=20),a.margin.right||(this.internal.margin.right=20),a.margin.top||(this.internal.margin.top=20),a.margin.bottom||(this.internal.margin.bottom=20)):(this.internal.margin={},this.internal.margin.left=this.internal.margin.right=this.internal.margin.top=this.internal.margin.bottom=20),o.call(this)},p.setXAttribute=function(a){this.internal.config.columns.x=a,k.call(this)},p.setYAttribute=function(a){this.internal.config.columns.y=a,l.call(this)},p.renderChart=function(a){var f=this.internal.config.columns;if(a&&(this.internal.config.data=a),!a)return void console.log("Data not found");var g=this.internal.config.data;this.internal.xScale.domain([d3.min(g,b.bind(this)),d3.max(g,b.bind(this))]),this.internal.yScale.domain([d3.min(g,d.bind(this)),d3.max(g,d.bind(this))]),this.internal.quadTreeFactory=d3.geom.quadtree().extent([[0,0],[this.internal.size.width,this.internal.size.height]]).x(c.bind(this)).y(e.bind(this)),this.internal.quadTree=this.internal.quadTreeFactory(g),this.internal.xAxis.ticks(g.length),"string"===this.internal.xColumnType&&this.internal.xAxis.tickFormat(function(a){var b=g.map(function(a){return a[this.internal.config.columns.x]}.bind(this));return b[a]}.bind(this)),this.internal.chartGroup.append("g").attr("class","x axis").attr("transform","translate(0,"+this.internal.size.height+")").call(this.internal.xAxis).selectAll("text").style("text-anchor","end").attr("dx","-.8em").attr("dy",".15em").attr("transform",function(){return"rotate(-45)"}),this.internal.xAxisLabel=this.internal.chartGroup.append("text").attr("y",this.internal.size.height+this.internal.margin.top+this.internal.margin.bottom/2).attr("x",this.internal.size.width/2).attr("dy","1em").style("text-anchor","middle").text(f.x),"string"===this.internal.yColumnType&&this.internal.yAxis.tickFormat(function(a){var b=g.map(function(a){return a[this.internal.columns.y]}.bind(this));return b[a]}.bind(this)),this.internal.chartGroup.append("g").attr("class","y axis").call(this.internal.yAxis),this.internal.yAxisLabel=this.internal.chartGroup.append("text").attr("transform","rotate(-90)").attr("y",0-this.internal.margin.left).attr("x",0-this.internal.size.height/2).attr("dy","1em").style("text-anchor","middle").text(f.y),this.internal.kdRect=this.internal.chartGroup.selectAll(".node").data(m(this.internal.quadTree)).enter().append("rect").attr("class","node").attr("x",function(a){return a.x1}).attr("y",function(a){return a.y1}).attr("width",function(a){return a.x2-a.x1}).attr("height",function(a){return a.y2-a.y1}),this.internal.point=this.internal.chartGroup.selectAll(".point").data(g).enter().append("circle").attr("class","point").attr("r",6).attr("cx",c.bind(this)).attr("cy",e.bind(this)),this.internal.chartGroup.append("circle").attr("id",this.internal.config.container+"pt").attr("r",6).style("fill","none"),this.internal.chartGroup.append("g").attr("class","brush").call(this.internal.brush)},p.probe=function(a){var b=this.internal.config.data,c=this.internal.config.columns.key;a?(this.internal.point.each(function(a){a.scanned=a.selected=!1}),b.map(function(b){b[c]==a&&(b.selected=!0)})):null===a&&this.internal.point.each(function(a){a.scanned=a.selected=!1}),this.internal.point.classed("scanned",function(a){return a.scanned}),this.internal.point.classed("selected",function(a){return a.selected})},p.select=function(a){var b=this.internal.config.data;a&&(this.internal.point.each(function(a){a.scanned=a.selected=!1}),b.filter(function(b){for(var c=0;c<a.length;c++)b[this.internal.config.columns.key]===a[c]&&(b.selected=!0)}.bind(this))),a&&0===a.length&&this.internal.point.each(function(a){a.scanned=a.selected=!1}),this.internal.point.classed("scanned",function(a){return a.scanned}),this.internal.point.classed("selected",function(a){return a.selected})},d3Chart.Scatterplot=a}();
