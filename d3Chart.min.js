this.d3Chart={},function(){function a(a){g=a,f=a.container?"#"+a.container:"body",b.call(this),g.data&&this.renderChart(g.data)}function b(){var a=this;p=function(a,b){if("string"==typeof a[g.columns.x]){if(isNaN(Number(a[g.columns.x])))return l="string",void 0===a.index?(a.index=b,b):("string"==typeof a.index&&(a.index=Number(a.index)),a.index);l="number",a[g.columns.x]=Number(a[g.columns.x])}return a[g.columns.x]},s=d3.scale.linear().range([0,g.size.width]),u=function(a,b){return s(p.apply(this,[a,b]))},w=d3.svg.axis().scale(s).orient("bottom"),q=function(a){if("string"==typeof a[g.columns.y]){if(isNaN(Number(a[g.columns.y])))return m="string",void 0===a.index?(a.index=i,i):("string"==typeof a.index&&(a.index=Number(a.index)),a.index);m="number",a[g.columns.y]=Number(a[g.columns.y])}return a[g.columns.y]},t=d3.scale.linear().range([g.size.height,0]),v=function(a,b){return t(q.apply(this,[a,b]))},x=d3.svg.axis().scale(t).orient("left"),r=function(a){return a[g.columns.color]},n=d3.select(f).append("svg").attr("width",g.size.width+g.margin.left+g.margin.right).attr("height",g.size.height+g.margin.top+g.margin.bottom).append("g").attr("transform","translate("+g.margin.left+","+g.margin.top+")").on("mousemove",function(){var b=d3.mouse(d3.select(this)[0][0]);n.selectAll(f+"pt").attr("cx",b[0]).attr("cy",b[1]),e.call(a)}),j=d3.svg.brush().x(d3.scale.identity().domain([-5,g.size.width+5])).y(d3.scale.identity().domain([-5,g.size.height+5])).on("brush",this._brushed.bind(this))}function c(){s.domain([d3.min(g.data,p.bind(this)),d3.max(g.data,p.bind(this))]);var a=d3.select(f).transition();a.selectAll(".point").duration(750).attr("cx",u.bind(this)),a.select(".x.axis").duration(750).call(w)}function d(){t.domain([d3.min(g.data,q.bind(this)),d3.max(g.data,q.bind(this))]);var a=d3.select(f).transition();a.selectAll(".point").duration(750).attr("cy",v.bind(this)),a.select(".y.axis").duration(750).call(x)}function e(){pt=d3.selectAll(f+"pt");var a=+pt.attr("cx"),b=+pt.attr("cy");o.each(function(a){a.scanned=a.selected=!1}),k.each(function(a){a.visited=!1});var c=this.nearest.call(this,a,b,{d:8,p:null},h);c.p&&(c.p.selected=!0),this.probe(),g.interactions.onProbe&&g.interactions.onProbe.callback&&(c.p?g.interactions.onProbe.callback.call(this,c.p[g.columns.key]):g.interactions.onProbe.callback.call(this,null))}var f,g,h,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y=a.prototype;y.setXAttribute=function(a){g.columns.x=a,c.call(this)},y.setYAttribute=function(a){g.columns.y=a,d.call(this)},y.renderChart=function(a){return a&&(g.data=a),g.data?(s.domain([d3.min(g.data,p.bind(this)),d3.max(g.data,p.bind(this))]),t.domain([d3.min(g.data,q.bind(this)),d3.max(g.data,q.bind(this))]),h=d3.geom.quadtree().extent([[0,0],[g.size.width,g.size.height]]).x(u.bind(this)).y(v.bind(this))(g.data),w.ticks(g.data.length),"string"===l&&w.tickFormat(function(a){var b=g.data.map(function(a){return a[g.columns.x]}.bind(this));return b[a]}.bind(this)),n.append("g").attr("class","x axis").attr("transform","translate(0,"+g.size.height+")").call(w).selectAll("text").style("text-anchor","end").attr("dx","-.8em").attr("dy",".15em").attr("transform",function(){return"rotate(-45)"}),"string"===m&&x.tickFormat(function(a){var b=g.data.map(function(a){return a[g.columns.y]}.bind(this));return b[a]}.bind(this)),n.append("g").attr("class","y axis").call(x).append("text").attr("transform","rotate(-90)").attr("y",0-g.margin.left).attr("x",0-g.size.height/2).attr("dy","1em").style("text-anchor","middle").text(g.columns.y),k=n.selectAll(".node").data(this.nodes(h)).enter().append("rect").attr("class","node").attr("x",function(a){return a.x1}).attr("y",function(a){return a.y1}).attr("width",function(a){return a.x2-a.x1}).attr("height",function(a){return a.y2-a.y1}),o=n.selectAll(".point").data(g.data).enter().append("circle").attr("class","point").attr("r",6).attr("cx",u.bind(this)).attr("cy",v.bind(this)),n.append("circle").attr("id",g.container+"pt").attr("r",6).style("fill","none"),void n.append("g").attr("class","brush").call(j)):void console.log("Data not found")},y.nodes=function(a){var b=[];return a.depth=0,a.visit(function(a,c,d,e,f){a.x1=c,a.y1=d,a.x2=e,a.y2=f,b.push(a);for(var g=0;4>g;g++)a.nodes[g]&&(a.nodes[g].depth=a.depth+1)}),b},y.search=function(a,b,c,d,e){var f=[];return a.visit.call(this,function(a,h,i,j,k){var l=a.point;if(l){l.scanned=!0;var m=s(p.apply(this,[l]),l.index),n=t(q.apply(this,[l]),l.index);l.selected=m>=b&&d>m&&n>=c&&e>n,l.selected&&f.push(l[g.columns.key])}return h>=d||i>=e||b>j||c>k}.bind(this)),f},y._brushed=function(){var a=j.extent();o.each(function(a){a.scanned=a.selected=!1});var b=this.search.call(this,h,a[0][0],a[0][1],a[1][0],a[1][1]);this.select(),b&&g.interactions.onSelect&&g.interactions.onSelect.callback&&g.interactions.onSelect.callback.call(this,b)},y.nearest=function(a,b,c,d){var e=d.x1,f=d.y1,g=d.x2,h=d.y2;if(d.visited=!0,a<e-c.d||a>g+c.d||b<f-c.d||b>h+c.d)return c;var i=d.point;if(i){i.scanned=!0;var j=s(p.apply(this,[i]),i.index)-a,k=t(q.apply(this,[i]),i.index)-b,l=Math.sqrt(j*j+k*k);l<c.d&&(c.d=l,c.p=i)}var m=d.nodes,n=2*a>e+g,o=2*b>f+h;return m[2*o+n]&&(c=this.nearest.call(this,a,b,c,m[2*o+n])),m[2*o+(1-n)]&&(c=this.nearest.call(this,a,b,c,m[2*o+(1-n)])),m[2*(1-o)+n]&&(c=this.nearest.call(this,a,b,c,m[2*(1-o)+n])),m[2*(1-o)+(1-n)]&&(c=this.nearest.call(this,a,b,c,m[2*(1-o)+(1-n)])),c},y.probe=function(a){a?(o.each(function(a){a.scanned=a.selected=!1}),g.data.map(function(b){b[g.columns.key]==a&&(b.selected=!0)})):null===a&&o.each(function(a){a.scanned=a.selected=!1}),o.classed("scanned",function(a){return a.scanned}),o.classed("selected",function(a){return a.selected})},y.select=function(a){a&&(o.each(function(a){a.scanned=a.selected=!1}),g.data.filter(function(b){for(var c=0;c<a.length;c++)b[g.columns.key]===a[c]&&(b.selected=!0)}.bind(this))),a&&0===a.length&&o.each(function(a){a.scanned=a.selected=!1}),o.classed("scanned",function(a){return a.scanned}),o.classed("selected",function(a){return a.selected})},d3Chart.Scatterplot=a}();
