"undefined"==typeof window?this.d3Chart=this.d3Chart||{}:window.d3Chart=window.d3Chart||{},function(){var a=function(a,b,c){var c=c||window,d=!1,e=function(){d||(d=!0,requestAnimationFrame(function(){c.dispatchEvent(new CustomEvent(b)),d=!1}))};c.addEventListener(a,e)};a("resize","optimizedResize")}(),function(){function a(a){Object.defineProperty(this,"internal",{value:{}}),this.internal.xScale,this.internal.yScale,this.internal.xAxis,this.internal.yAxis,this.internal.xAxisLabel,this.internal.yAxisLabel,this.internal.xColumnType,this.internal.yColumnType,this.internal.container,this.internal.svg,this.internal.chartGroup,this.internal.points,this.internal.brush,this.internal.kdRect,this.internal.quadTreeFactory,this.internal.quadTree,a&&(this.create(a),this.config.data&&this.config.data.records.length>0&&this.renderChart(this.config.data))}function b(a,b){var c=this.config.data.columns.x;if("string"==typeof a[c]){if(isNaN(Number(a[c])))return this.internal.xColumnType="string",a.index=void 0===a.index?b:"string"==typeof a.index?Number(a.index):a.index,a.index;this.internal.xColumnType="number",a[c]=Number(a[c])}else"number"==typeof a[c]&&(this.internal.xColumnType="number");return a[c]}function c(a,b){var c=this.config.data.columns.y;if("string"==typeof a[c]){if(isNaN(Number(a[c])))return this.internal.yColumnType="string",a.index=void 0===a.index?b:"string"==typeof a.index?Number(a.index):a.index,a.index;this.internal.yColumnType="number",a[c]=Number(a[c])}else"number"==typeof a[c]&&(this.internal.yColumnType="number");return a[c]}function d(a,c){return this.internal.xScale(b.call(this,a,c))}function e(a,b){return this.internal.yScale(c.call(this,a,b))}function f(a,d,e,f,g){var h=[],i=this.config.data.columns.key;return a.visit(function(a,j,k,l,m){var n=a.point;if(n){n.scanned=!0;var o=this.internal.xScale(b.call(this,n,n.index)),p=this.internal.yScale(c.call(this,n,n.index));n.selected=o>=d&&f>o&&p>=e&&g>p,n.selected&&h.push(n[i])}return j>=f||k>=g||d>l||e>m}.bind(this)),h}function g(){var a=this.config.interactions.onSelect,b=this.internal.brush.extent();this.internal.points.each(function(a){a.scanned=a.selected=!1});var c=f.call(this,this.internal.quadTree,b[0][0],b[0][1],b[1][0],b[1][1]);this.select(),c&&a&&a.callback&&a.callback.call(this,c)}function h(a,d,e,f){var g=f.x1,i=f.y1,j=f.x2,k=f.y2;if(f.visited=!0,a<g-e.d||a>j+e.d||d<i-e.d||d>k+e.d)return e;var l=f.point;if(l){l.scanned=!0;var m=this.internal.xScale(b.call(this,l,l.index))-a,n=this.internal.yScale(c.call(this,l,l.index))-d,o=Math.sqrt(m*m+n*n);o<e.d&&(e.d=o,e.p=l)}var p=f.nodes,q=2*a>g+j,r=2*d>i+k;return p[2*r+q]&&(e=h.call(this,a,d,e,p[2*r+q])),p[2*r+(1-q)]&&(e=h.call(this,a,d,e,p[2*r+(1-q)])),p[2*(1-r)+q]&&(e=h.call(this,a,d,e,p[2*(1-r)+q])),p[2*(1-r)+(1-q)]&&(e=h.call(this,a,d,e,p[2*(1-r)+(1-q)])),e}function i(){var a=this.config.interactions.onProbe,b=this.config.data.columns.key,c=+this.internal.probeCircle.attr("cx"),d=+this.internal.probeCircle.attr("cy");this.internal.points.each(function(a){a.scanned=a.selected=!1}),this.internal.kdRect.each(function(a){a.visited=!1});var e=h.call(this,c,d,{d:8,p:null},this.internal.quadTree);e.p&&(e.p.selected=!0),this.probe(),a&&a.callback&&(e.p?a.callback.call(this,e.p[b]):a.callback.call(this,null))}function j(a){var b=[];return a.depth=0,a.visit(function(a,c,d,e,f){a.x1=c,a.y1=d,a.x2=e,a.y2=f,b.push(a);for(var g=0;4>g;g++)a.nodes[g]&&(a.nodes[g].depth=a.depth+1)}),b}function k(a){var b=parseInt(a.style("width")),c=parseInt(a.style("height")),d=this;a.attr("viewBox","0 0 "+b+" "+c).attr("perserveAspectRatio","none").call(l.bind(null,d,a)),d3.select(window).on("resize."+this.internal.container.attr("id"),l.bind(null,d,a))}function l(a,b){{var c=parseInt(a.internal.container.style("width"));parseInt(a.internal.container.style("height"))}b.attr("width",c)}function m(){var a=this;this.internal.svg=this.internal.container.append("svg").attr("width",this.config.size.width+this.config.margin.left+this.config.margin.right).attr("height",this.config.size.height+this.config.margin.top+this.config.margin.bottom).call(k.bind(this)),this.internal.chartGroup=this.internal.svg.append("g").attr("transform","translate("+this.config.margin.left+","+this.config.margin.top+")"),this.internal.brush=d3.svg.brush().x(d3.scale.identity().domain([-5,this.config.size.width+5])).y(d3.scale.identity().domain([-5,this.config.size.height+5])),this.internal.chartGroup.append("g").attr("class","brush").call(this.internal.brush),this.internal.probeCircle=this.internal.chartGroup.append("circle").attr("id",this.config.container.id+"pt").attr("r",6).style("fill","none"),this.internal.xScale=d3.scale.linear().range([0,this.config.size.width]).nice(),this.internal.yScale=d3.scale.linear().range([this.config.size.height,0]).nice(),this.internal.xAxis=d3.svg.axis().scale(this.internal.xScale).orient("bottom").tickFormat(function(b){var c=b;if("string"===a.internal.xColumnType){var d=a.config.data.records[b];c=d?d[a.config.data.columns.x]:""}return c}),this.internal.yAxis=d3.svg.axis().scale(this.internal.yScale).orient("left").tickFormat(function(b){var c=b;if("string"===a.internal.yColumnType){var d=a.config.data.records[b];c=d?d[a.config.data.columns.y]:""}return c}),this.internal.quadTreeFactory=d3.geom.quadtree().extent([[0,0],[this.config.size.width,this.config.size.height]]).x(d.bind(this)).y(e.bind(this))}function n(){var a=this;this.internal.chartGroup.on("mousemove",function(){var b=d3.mouse(d3.select(this)[0][0]);a.internal.probeCircle.attr("cx",b[0]),a.internal.probeCircle.attr("cy",b[1]),i.call(a)}),this.internal.brush.on("brush",g.bind(a))}function o(){this.config.data.records;this.internal.xScale.domain([d3.min(this.config.data.records,b.bind(this)),d3.max(this.config.data.records,b.bind(this))]),this.internal.yScale.domain([d3.min(this.config.data.records,c.bind(this)),d3.max(this.config.data.records,c.bind(this))]),this.internal.chartGroup.append("g").attr("class","x axis").attr("transform","translate(0,"+this.config.size.height+")").call(this.internal.xAxis).selectAll("text").style("text-anchor","end").attr("dx","-.8em").attr("dy",".15em").attr("transform",function(){return"rotate(-45)"}),this.internal.xAxisLabel=this.internal.chartGroup.append("text").attr("y",this.config.size.height+this.config.margin.top+this.config.margin.bottom/2).attr("x",this.config.size.width/2).attr("dy","1em").style("text-anchor","middle").text(this.config.data.columns.x),this.internal.chartGroup.append("g").attr("class","y axis").call(this.internal.yAxis).selectAll("text").style("text-anchor","end").attr("dx","-.8em").attr("transform",function(){return"rotate(-45)"}),this.internal.yAxisLabel=this.internal.chartGroup.append("text").attr("transform","rotate(-90)").attr("y",0-this.config.margin.left).attr("x",0-this.config.size.height/2).attr("dy","1em").style("text-anchor","middle").text(this.config.data.columns.y)}function p(){{var a=this;a.config.data.records}this.internal.quadTree=this.internal.quadTreeFactory(this.config.data.records),this.internal.kdRect=this.internal.chartGroup.selectAll(".node").data(j(this.internal.quadTree)),this.internal.kdRect.enter().append("rect").attr("class","node").attr("x",function(a){return a.x1}).attr("y",function(a){return a.y1}).attr("width",function(a){return a.x2-a.x1}).attr("height",function(a){return a.y2-a.y1}),this.internal.points=this.internal.chartGroup.selectAll(".point").data(this.config.data.records),this.internal.points.enter().append("circle").attr("class","point").attr("r",6).attr("cx",d.bind(this)).attr("cy",e.bind(this))}function q(){this.internal.xScale.domain([d3.min(this.config.data.records,b.bind(this)),d3.max(this.config.data.records,b.bind(this))]),this.internal.yScale.domain([d3.min(this.config.data.records,c.bind(this)),d3.max(this.config.data.records,c.bind(this))]),this.internal.quadTreeFactory.x(d.bind(this)),this.internal.quadTreeFactory.y(e.bind(this)),this.internal.quadTree=this.internal.quadTreeFactory(this.config.data.records),this.internal.kdRect=this.internal.chartGroup.selectAll(".node").data(j(this.internal.quadTree)),this.internal.kdRect.enter().append("rect").attr("class","node").attr("x",function(a){return a.x1}).attr("y",function(a){return a.y1}).attr("width",function(a){return a.x2-a.x1}).attr("height",function(a){return a.y2-a.y1}),this.internal.kdRect.transition().duration(350).attr("x",function(a){return a.x1}).attr("y",function(a){return a.y1}).attr("width",function(a){return a.x2-a.x1}).attr("height",function(a){return a.y2-a.y1}),this.internal.kdRect.exit().transition().duration(350).remove(),this.internal.points=this.internal.chartGroup.selectAll(".point").data(this.config.data.records),this.internal.points.enter().append("circle").attr("class","point").attr("r",6).attr("cx",d.bind(this)).attr("cy",e.bind(this)),this.internal.points.transition().duration(350).attr("cx",d.bind(this)).attr("cy",e.bind(this)),this.internal.points.exit().transition().duration(350).remove(),this.internal.chartGroup.select(".x.axis").transition().duration(350).call(this.internal.xAxis).selectAll("text").style("text-anchor","end").attr("dx","-.8em").attr("dy",".15em").attr("transform",function(){return"rotate(-45)"}),this.internal.chartGroup.select(".y.axis").transition().duration(350).call(this.internal.yAxis).selectAll("text").style("text-anchor","end").attr("dx","-.8em").attr("transform",function(){return"rotate(-45)"}),this.internal.xAxisLabel.text(this.config.data.columns.x),this.internal.yAxisLabel.text(this.config.data.columns.y)}function r(){var a=(this.config.data.records,this.config.data.columns.x);this.internal.xScale.domain([d3.min(this.config.data.records,b.bind(this)),d3.max(this.config.data.records,b.bind(this))]),this.internal.quadTreeFactory.x(d.bind(this)),this.internal.quadTree=this.internal.quadTreeFactory(this.config.data.records),this.internal.kdRect=this.internal.chartGroup.selectAll(".node").data(j(this.internal.quadTree)),this.internal.kdRect.transition().duration(350).attr("x",function(a){return a.x1}).attr("y",function(a){return a.y1}).attr("width",function(a){return a.x2-a.x1}).attr("height",function(a){return a.y2-a.y1}),this.internal.points.transition().duration(350).attr("cx",d.bind(this)),this.internal.chartGroup.select(".x.axis").transition().duration(350).call(this.internal.xAxis).selectAll("text").style("text-anchor","end").attr("dx","-.8em").attr("dy",".15em").attr("transform",function(){return"rotate(-45)"}),this.internal.xAxisLabel.text(a)}function s(){var a=(this.config.data.records,this.config.data.columns.y);this.internal.yScale.domain([d3.min(this.config.data.records,c.bind(this)),d3.max(this.config.data.records,c.bind(this))]),this.internal.quadTreeFactory.y(e.bind(this)),this.internal.quadTree=this.internal.quadTreeFactory(this.config.data.records),this.internal.kdRect=this.internal.chartGroup.selectAll(".node").data(j(this.internal.quadTree)),this.internal.kdRect.transition().duration(350).attr("x",function(a){return a.x1}).attr("y",function(a){return a.y1}).attr("width",function(a){return a.x2-a.x1}).attr("height",function(a){return a.y2-a.y1}),this.internal.points.transition().duration(350).attr("cy",e.bind(this)),this.internal.chartGroup.select(".y.axis").transition().duration(350).call(this.internal.yAxis).selectAll("text").style("text-anchor","end").attr("dx","-.8em").attr("transform",function(){return"rotate(-45)"}),this.internal.yAxisLabel.text(a)}function t(){var a=this;a.internal.chartGroup.on("mousemove",null),a.internal.brush.on("brush",null),d3.select(window).on("resize."+a.internal.container.attr("id"),null)}var u=a.prototype;u.create=function(a){this.config={},a.container?"String"===a.container.constructor.name?this.config.container={element:document.getElementById(a.container),id:a.container}:"HTMLDivElement"===a.container.constructor.name||a.container.constructor===HTMLDivElementConstructor?this.config.container={element:a.container,id:a.container.id}:console.log("Error: "+a.container+" - Not a HTMLDivElement element "):"String"===this.config.container.constructor.name&&(this.config.container={element:document.getElementById(a.container),id:"body"}),this.internal.container=d3.select(this.config.container.element),a.size?(this.config.size=a.size,a.size.width||(this.config.size.width=parseInt(this.internal.container.style("width"),10)),a.size.height||(this.config.size.height=parseInt(this.internal.container.style("height"),10),0==this.config.size.height&&(this.config.size.height=400))):(this.config.size={},this.config.size.width=parseInt(this.internal.container.style("width"),10),this.config.size.height=parseInt(this.internal.container.style("height"),10),0==this.config.size.height&&(this.config.size.height=400)),a.margin?(this.config.margin=a.margin,a.margin.left||(this.config.margin.left=20),a.margin.right||(this.config.margin.right=20),a.margin.top||(this.config.margin.top=20),a.margin.bottom||(this.config.margin.bottom=20)):(this.config.margin={},this.config.margin.left=this.config.margin.right=this.config.margin.top=this.config.margin.bottom=20),this.config.interactions=a.interactions?a.interactions:{},m.call(this)},u.renderChart=function(a){if(!a.records)return void console.error("Data not found");var b=a.columns;if(!b.x)return void console.error("x column is not set yet");if(b.x.constructor!==String)return void console.error("x value has to be a Column Name in String format."+b.x.constructor.name+" is not supported");if(!b.y)return void console.error("y column is not set yet");if(b.y.constructor!==String)return void console.error("y value has to be a Column Name in String format."+b.y.constructor.name+" is not supported");var c=a.records;if(!b.key)if(c[0].hasOwnProperty("index"))b.key="index";else{console.warn("Its a good practise to set key column. failing to do so, will create a index as key column"),b.key="index";for(var d=0;d<c.length;d++){var e=c[d];e.index=d}}if(this.config.data)return this.config.data=a,void q.call(this);if(a&&(this.config.data=a),!this.config.data.records)return void console.error("Data not found");this.config.data.columns=a.columns?a.columns:{x:"",y:"",key:""};var b=this.config.data.columns;if(!b.x)return void console.error("x column is not set yet");if(b.x.constructor!==String)return void console.error("x value has to be a Column Name in String format."+b.x.constructor.name+" is not supported");if(!b.y)return void console.error("y column is not set yet");if(b.y.constructor!==String)return void console.error("y value has to be a Column Name in String format."+b.y.constructor.name+" is not supported");var c=this.config.data.records;if(!b.key)if(c[0].hasOwnProperty("index"))b.key="index";else{console.warn("Its a good practise to set key column. failing to do so, will create a index as key column"),b.key="index";for(var d=0;d<c.length;d++){var e=c[d];e.index=d}}o.call(this),p.call(this),n.call(this)},u.setXAttribute=function(a){this.config.data.columns.x!==a&&(this.config.data.columns.x=a,r.call(this))},u.setYAttribute=function(a){this.config.data.columns.y!==a&&(this.config.data.columns.y=a,s.call(this))},u.probe=function(a){var b=this.config.data.records,c=this.config.data.columns.key;a?(this.internal.points.each(function(a){a.scanned=a.selected=!1}),b.map(function(b){b[c]===a&&(b.selected=!0)})):null===a&&this.internal.points.each(function(a){a.scanned=a.selected=!1}),this.internal.points.classed("scanned",function(a){return a.scanned}),this.internal.points.classed("selected",function(a){return a.selected})},u.select=function(a){var b=this.config.data.records;a&&(this.internal.points.each(function(a){a.scanned=a.selected=!1}),b.filter(function(b){for(var c=0;c<a.length;c++)b[this.config.data.columns.key]===a[c]&&(b.selected=!0)}.bind(this))),a&&0===a.length&&this.internal.points.each(function(a){a.scanned=a.selected=!1}),this.internal.points.classed("scanned",function(a){return a.scanned}),this.internal.points.classed("selected",function(a){return a.selected})},u.dispose=function(){t.call(this)},d3Chart.Scatterplot=a}();
