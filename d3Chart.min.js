this.d3Chart={},function(){function a(a){p=a,o=a.container?"#"+a.container:"body",n.call(this),p.data&&this.renderChart(p.data)}function b(a,b){if("string"==typeof a[p.columns.x]){if(isNaN(Number(a[p.columns.x])))return u="string",void 0===a.index?(a.index=b,b):("string"==typeof a.index&&(a.index=Number(a.index)),a.index);u="number",a[p.columns.x]=Number(a[p.columns.x])}return a[p.columns.x]}function c(a,c){return A(b(a,c))}function d(a){if("string"==typeof a[p.columns.y]){if(isNaN(Number(a[p.columns.y])))return v="string",void 0===a.index?(a.index=i,i):("string"==typeof a.index&&(a.index=Number(a.index)),a.index);v="number",a[p.columns.y]=Number(a[p.columns.y])}return a[p.columns.y]}function e(a,b){return B(d(a,b))}function f(a,c,e,f,g){var h=[];return a.visit(function(a,i,j,k,l){var m=a.point;if(m){m.scanned=!0;var n=A(b(m),m.index),o=B(d(m),m.index);m.selected=n>=c&&f>n&&o>=e&&g>o,m.selected&&h.push(m[p.columns.key])}return i>=f||j>=g||c>k||e>l}),h}function g(){var a=s.extent();z.each(function(a){a.scanned=a.selected=!1});var b=f(r,a[0][0],a[0][1],a[1][0],a[1][1]);this.select(),b&&p.interactions.onSelect&&p.interactions.onSelect.callback&&p.interactions.onSelect.callback.call(this,b)}function h(a,c,e,f){var g=f.x1,i=f.y1,j=f.x2,k=f.y2;if(f.visited=!0,a<g-e.d||a>j+e.d||c<i-e.d||c>k+e.d)return e;var l=f.point;if(l){l.scanned=!0;var m=A(b(l),l.index)-a,n=B(d(l),l.index)-c,o=Math.sqrt(m*m+n*n);o<e.d&&(e.d=o,e.p=l)}var p=f.nodes,q=2*a>g+j,r=2*c>i+k;return p[2*r+q]&&(e=h(a,c,e,p[2*r+q])),p[2*r+(1-q)]&&(e=h(a,c,e,p[2*r+(1-q)])),p[2*(1-r)+q]&&(e=h(a,c,e,p[2*(1-r)+q])),p[2*(1-r)+(1-q)]&&(e=h(a,c,e,p[2*(1-r)+(1-q)])),e}function j(){pt=d3.selectAll(o+"pt");var a=+pt.attr("cx"),b=+pt.attr("cy");z.each(function(a){a.scanned=a.selected=!1}),t.each(function(a){a.visited=!1});var c=h(a,b,{d:8,p:null},r);c.p&&(c.p.selected=!0),this.probe(),p.interactions.onProbe&&p.interactions.onProbe.callback&&(c.p?p.interactions.onProbe.callback.call(this,c.p[p.columns.key]):p.interactions.onProbe.callback.call(this,null))}function k(){A.domain([d3.min(p.data,b),d3.max(p.data,b)]),q.x(c),r=q(p.data),t.data(m(r));var a=d3.select(o).transition();a.selectAll(".point").duration(750).attr("cx",c),a.selectAll(".node").duration(750).attr("x",function(a){return a.x1}).attr("y",function(a){return a.y1}).attr("width",function(a){return a.x2-a.x1}).attr("height",function(a){return a.y2-a.y1}),a.select(".x.axis").duration(750).call(C),w.text(p.columns.x)}function l(){B.domain([d3.min(p.data,d),d3.max(p.data,d)]),q.y(e),r=q(p.data),t.data(m(r));var a=d3.select(o).transition();a.selectAll(".point").duration(750).attr("cy",e.bind(this)),a.selectAll(".node").duration(750).attr("x",function(a){return a.x1}).attr("y",function(a){return a.y1}).attr("width",function(a){return a.x2-a.x1}).attr("height",function(a){return a.y2-a.y1}),a.select(".y.axis").duration(750).call(D),x.text(p.columns.y)}function m(a){var b=[];return a.depth=0,a.visit(function(a,c,d,e,f){a.x1=c,a.y1=d,a.x2=e,a.y2=f,b.push(a);for(var g=0;4>g;g++)a.nodes[g]&&(a.nodes[g].depth=a.depth+1)}),b}function n(){var a=this;A=d3.scale.linear().range([0,p.size.width]),C=d3.svg.axis().scale(A).orient("bottom"),B=d3.scale.linear().range([p.size.height,0]),D=d3.svg.axis().scale(B).orient("left"),y=d3.select(o).append("svg").attr("width",p.size.width+p.margin.left+p.margin.right).attr("height",p.size.height+p.margin.top+p.margin.bottom).append("g").attr("transform","translate("+p.margin.left+","+p.margin.top+")").on("mousemove",function(){var b=d3.mouse(d3.select(this)[0][0]);y.selectAll(o+"pt").attr("cx",b[0]).attr("cy",b[1]),j.call(a)}),s=d3.svg.brush().x(d3.scale.identity().domain([-5,p.size.width+5])).y(d3.scale.identity().domain([-5,p.size.height+5])).on("brush",g.bind(a))}var o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E=a.prototype;E.getQuadTree=function(){return r},E.setXAttribute=function(a){p.columns.x=a,k()},E.setYAttribute=function(a){p.columns.y=a,l()},E.renderChart=function(a){return a&&(p.data=a),p.data?(A.domain([d3.min(p.data,b),d3.max(p.data,b)]),B.domain([d3.min(p.data,d),d3.max(p.data,d)]),q=d3.geom.quadtree().extent([[0,0],[p.size.width,p.size.height]]).x(c).y(e),r=q(p.data),C.ticks(p.data.length),"string"===u&&C.tickFormat(function(a){var b=p.data.map(function(a){return a[p.columns.x]}.bind(this));return b[a]}.bind(this)),y.append("g").attr("class","x axis").attr("transform","translate(0,"+p.size.height+")").call(C).selectAll("text").style("text-anchor","end").attr("dx","-.8em").attr("dy",".15em").attr("transform",function(){return"rotate(-45)"}),w=y.append("text").attr("y",p.size.height+p.margin.top+p.margin.bottom/2).attr("x",p.size.width/2).attr("dy","1em").style("text-anchor","middle").text(p.columns.x),"string"===v&&D.tickFormat(function(a){var b=p.data.map(function(a){return a[p.columns.y]}.bind(this));return b[a]}.bind(this)),y.append("g").attr("class","y axis").call(D),x=y.append("text").attr("transform","rotate(-90)").attr("y",0-p.margin.left).attr("x",0-p.size.height/2).attr("dy","1em").style("text-anchor","middle").text(p.columns.y),t=y.selectAll(".node").data(m(r)).enter().append("rect").attr("class","node").attr("x",function(a){return a.x1}).attr("y",function(a){return a.y1}).attr("width",function(a){return a.x2-a.x1}).attr("height",function(a){return a.y2-a.y1}),z=y.selectAll(".point").data(p.data).enter().append("circle").attr("class","point").attr("r",6).attr("cx",c).attr("cy",e),y.append("circle").attr("id",p.container+"pt").attr("r",6).style("fill","none"),void y.append("g").attr("class","brush").call(s)):void console.log("Data not found")},E.probe=function(a){a?(z.each(function(a){a.scanned=a.selected=!1}),p.data.map(function(b){b[p.columns.key]==a&&(b.selected=!0)})):null===a&&z.each(function(a){a.scanned=a.selected=!1}),z.classed("scanned",function(a){return a.scanned}),z.classed("selected",function(a){return a.selected})},E.select=function(a){a&&(z.each(function(a){a.scanned=a.selected=!1}),p.data.filter(function(b){for(var c=0;c<a.length;c++)b[p.columns.key]===a[c]&&(b.selected=!0)}.bind(this))),a&&0===a.length&&z.each(function(a){a.scanned=a.selected=!1}),z.classed("scanned",function(a){return a.scanned}),z.classed("selected",function(a){return a.selected})},d3Chart.Scatterplot=a}();
